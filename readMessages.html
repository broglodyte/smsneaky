<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
    <title>Read Messages</title>
	<link rel="stylesheet" href="/css/main.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>
	
$(document).ready(function(){
    $("button").click(function(){
        $("div").animate({
            left: '250px',
            opacity: '0.5',
            height: '150px',
            width: '150px'
        });
    });
});

var msgDict = {};
var senderList = [];

$(document).ready( initTextList );

function initTextList() {
	$.getJSON("/inbox/from", function(fromList) {
		if(fromList && fromList.length) {
//			jsonData = result;
			
			$.each(fromList, (index, fromNumber) => {
				$.getJSON(`/contacts/${fromNumber}`, function(fromObj) {
					var fromName = "Unknown";
					if(fromObj)
						fromName = fromObj.fullName || fromObj.name || fromNumber;
					
					var senderHeaderDiv = document.createElement("div");
					senderHeaderDiv.id = `div_${fromName}`;
					senderHeaderDiv.className = "senderHeader";
					senderHeaderDiv.innerHTML = fromName;
					$("div#mainHolder").append(senderHeaderDiv);
					console.log(`ID: [div_${fromName}]`);
					
					$.getJSON(`/inbox/from/${fromNumber}`, function(msgListFromNumber) {
						console.log(`  > [${msgListFromNumber.length} messages]`);
						
					});
				});
					
				senderMsgList.push(message);
				msgDict[sender] = senderMsgList;
			});
			
//			$.each(msgDict, (key, value) => {
//				console.log(`key:${key} = value:${value}`);
//			});	
/*			
				var msgHtml = $('<H2></H2>').text(senderKey);
				var msgList = msgDict[senderKey].sort((a,b) => {return a.timestamp<b.timestamp?-1:1});
				$("div#accordion").append(msgHtml);
				
				for(msgBlob in msgList) {
					var message = document.createElement("div");
					message.innerHTML = `<p class="datetime">${msgBlob.datetime}</p>\n<p class="msgText">${msgBlob.payload}</p>\n<hr>\n\n
				} 
			}     */
			
		}
	});
}
    </script>
</head>

<body>

<div class="mainHolder">
<!-- 
	<div class="senderHolder" id="header_$SENDER">
		<h3>$SENDER</h3>
	</div>  -->
	<div class="MessageList" id="div_$SENDER">

		<table id="msgTbl_$SENDER">
			<tr>
				<th onclick="toggleMessageList()" colspan="2">$SENDER</th>
			</tr>
			<tr class="msgRow" id="msgRow_$MSG[$I].ID">
				<td class="timeColumn">$MSG[$i].DATETIME</td>
				<td class="dataColumn">$MSG[$i].DATA</td>
			</tr>
		</table>

	</div>
-->
</div>

</body>
</html>
